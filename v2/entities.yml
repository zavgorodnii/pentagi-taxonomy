# Schema version (must match parent version directory)
version: 2

nodes:
  Target:
    description: "A target system being assessed during penetration testing"
    fields:
      version:
        type: int
        description: "Taxonomy schema version (auto-injected by Graphiti fork)"
      uuid:
        type: string
        description: "Unique identifier"
      hostname:
        type: string
        description: "DNS hostname if known"
      ip_address:
        type: string
        description: "IP address of the target"
        regex: "^(?:[0-9]{1,3}\\.){3}[0-9]{1,3}$"
      target_type:
        type: string
        description: "Classification of target"
        enum: [host, web_service, api, domain]
      risk_score:
        type: float
        description: "Calculated risk score"
        min: 0.0
        max: 10.0
      status:
        type: string
        description: "Current status"
        enum: [active, inactive, scanning]
      discovered_at:
        type: timestamp
        description: "When the target was first discovered"

  Port:
    description: "A network port on a target system"
    fields:
      version:
        type: int
        description: "Taxonomy schema version (auto-injected by Graphiti fork)"
      uuid:
        type: string
        description: "Unique identifier"
      port_number:
        type: int
        description: "Port number"
        min: 1
        max: 65535
      protocol:
        type: string
        description: "Network protocol"
        enum: [tcp, udp]
      state:
        type: string
        description: "Port state"
        enum: [open, closed, filtered]
      discovered_at:
        type: timestamp
        description: "Discovery timestamp"

  Vulnerability:
    description: "A security vulnerability identified during assessment"
    fields:
      version:
        type: int
        description: "Taxonomy schema version (auto-injected by Graphiti fork)"
      uuid:
        type: string
        description: "Unique identifier"
      vuln_id:
        type: string
        description: "Custom vulnerability identifier"
      title:
        type: string
        description: "Vulnerability title"
      severity:
        type: string
        description: "Severity classification"
        enum: [critical, high, medium, low, info]
      cvss_score:
        type: float
        description: "CVSS score"
        min: 0.0
        max: 10.0
      exploitable:
        type: boolean
        description: "Whether the vulnerability is exploitable"
      discovered_at:
        type: timestamp
        description: "Discovery timestamp"

edges:
  HAS_PORT:
    description: "A target has a port"
    fields:
      version:
        type: int
        description: "Taxonomy schema version (auto-injected by Graphiti fork)"
      timestamp:
        type: timestamp
        description: "When association was established"

  DISCOVERED:
    description: "An action discovered an entity"
    fields:
      version:
        type: int
        description: "Taxonomy schema version (auto-injected by Graphiti fork)"
      timestamp:
        type: timestamp
        description: "Discovery timestamp"
      confidence:
        type: float
        description: "Confidence score"
        min: 0.0
        max: 1.0
      method:
        type: string
        description: "Discovery method"
        enum: [active, passive]

  AFFECTS:
    description: "A vulnerability affects a target or service"
    fields:
      version:
        type: int
        description: "Taxonomy schema version (auto-injected by Graphiti fork)"
      timestamp:
        type: timestamp
        description: "When the relationship was identified"
      impact:
        type: string
        description: "Type of impact"
        enum: [direct, indirect]

relationships:
  - source: Target
    target: Port
    edges: [HAS_PORT]
  
  - source: Vulnerability
    target: Target
    edges: [AFFECTS]

